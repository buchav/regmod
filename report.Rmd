---
title: "Regression Models Course Project"
author: "Victor Bucha"
date: "19th of October"
output: html_document
---
# Samples
https://rpubs.com/stephenmoore56/56053
http://rstudio-pubs-static.s3.amazonaws.com/20260_6b6ddcddd3ba4432804990538f00f179.html
http://rstudio-pubs-static.s3.amazonaws.com/20260_6b6ddcddd3ba4432804990538f00f179.html
http://stackoverflow.com/questions/12012746/bestglm-alternatives-for-dataset-with-many-variables

# Task
You work for Motor Trend, a magazine about the automobile industry. Looking at a data set of a collection of cars, they are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). They are particularly interested in the following two questions:

Q1: Is an automatic or manual transmission better for MPG  
Q2: Quantify the MPG difference between automatic and manual transmissions

Your report must be:
Written as a PDF printout of a compiled (using knitr) R markdown document.
Brief. Roughly the equivalent of 2 pages or less for the main text. Supporting figures in an appendix can be included up to 5 total pages including the 2 for the main report. The appendix can only include figures.
Include a first paragraph executive summary.

#Executive summary

#Exploatory analysis 
At first, let us create boxplot showing the distribution of mpg for different types of trasmission. It looks like cars with automatic transmisson tend to have lower mpg.

```{r, Exploratory analysis}
data(mtcars) #load data
library(ggplot2)
p <- ggplot(mtcars, aes(factor(am), mpg))
p + geom_boxplot(aes(fill=factor(am)))+
        labs(title="MPG vs Transmission",x="Transimssion type",y="MPG")+
        scale_fill_discrete("Transmission",labels=c("Auto", "Manual"))
```

## Inference
Assuming the data has a normal distribution let us make t-test in order to show that automatic transmission has lower mean mpg value than cars with manual transmission. We will test following hypotheses H0: mu=0, H1: mu<0.

```{r, T-test}
t.test(subset(mtcars,am==0,mpg),subset(mtcars,am==1,mpg),alternative="less")
```
P-value is small and both confidence interval values are negative. So we reject null hypothesis and accept alternative. It means cars with automatic transmission has less average MPG than cars with manual transmission with 95% confidence.

#Regression analysis
In this section, we start to build several regression models. We started from simple linear regression model with one regressor. Then proceed with multivariable regression model by addding the variable that has the strongest correlation with mpg. Finnaly, 

###Base regression model
Let us build simple linear reggression model with [mpg] as outcome and one regressor as [am].
```{r, Base regression model}
m1<-lm(mpg~am,mtcars)
summary(m1)
```
#### Coefficients interpretation
* Beta0/intercept is equal to 17.147. It corresponds to the mean mpg value for cars with automatic transmission
* Beta1 is equal to 7.245. It increases of MPG for cars with manual transmission.
* Adjusted R-squared is equal 0.3385. So ~34% of mpg variability can be explained by transmission type. 

### Multivariable regression 
In previous section, we saw that the base regression model is very weak in prediction. Let us find the predictor whose correlation with MPG is the highest.

```{r, Compute correlation}
cor(mtcars)[,1]
```

Weight [wt] has the highest negative correlation -0.8676594 with MPG. Let us select it as a second predictor and build new linear regression model.

```{r, Multivariable regression model}
m2<-lm(mpg~wt+factor(am),mtcars)
summary(m2)
```
#### Coefficients interpretation
* Adjusted R-squared grows more than two times. With a new model we can explain ~75% of MPG variability. 
* It's interesting that [am] slope coefficient beta2 changed the sign and p-value become extremely large 0.988. That means beta2 is not statistically important in this model.

Transmission type [am] is a binary variable taking 0 for auto and 1 for manual transmissions. Above model fits parallel lines for the two levels of factor variable [am]. Since [am] slope coefficient beta2 is close to zero (-0.02362) it adds a litle to intercept of the second parallel line. So they are almost identical.  Bellow figure show it in more details.

```{r, Model plot, echo=FALSE}
ggplot(mtcars,aes(y=mpg,x=wt))+
        geom_point(aes(colour=factor(am)),size=8,alpha=0.7)+
        geom_point(colour="grey90",size=5,alpha=0.6)+
        geom_abline(intercept=m2$coefficients[1],slope=m2$coefficients[2],
                    aes(colour="0"),linetype=1,size=2)+
        geom_abline(intercept=m2$coefficients[1]+m2$coefficients[3],
                    slope=m2$coefficients[2],aes(colour="1"),linetype=2,size=2)+
        labs(title="lm(mpg~wt+factor(am),mtcars)",x="Weight",y="MPG")+
        scale_color_discrete("Transmission",labels=c("Auto", "Manual"))
```

### Multivariable regression with interaction
Let us make interaction with variable [am] and [wt] in order to improve our model. 

```{r, Multivariable regression model 2}
m3<-lm(mpg~wt*factor(am),mtcars)
summary(m3)
```
#### Coefficients interpretation
* Adjusted R-squared grows up to 0.833. With a new model we can explain ~83% of MPG variability.
* P-values are small. So all coefficients are statisticaly important

Now our model with inteaction term allows both a diffirent intercept and slope for each group. See bellow figure for more details. Because of that we have better prediction model.

```{r, Model interaction plot, echo=FALSE}
ggplot(mtcars,aes(y=mpg,x=wt))+
        geom_point(aes(colour=factor(am)),size=8,alpha=0.7)+
        geom_point(colour="grey90",size=5,alpha=0.6)+
        geom_abline(intercept=m3$coefficients[1],slope=m3$coefficients[2],
                    aes(colour="0"),linetype=1,size=2)+
        geom_abline(intercept=m3$coefficients[1]+m3$coefficients[3],
                    slope=m3$coefficients[2]+m3$coefficients[4],
                    aes(colour="1"),linetype=2,size=2)+
        labs(title="lm(mpg~wt*factor(am),mtcars)",x="Weight",y="MPG")+
        scale_color_discrete("Transmission",labels=c("Auto", "Manual"))
```


###Selection of the best model
Let us select the best model using anova to test the models against one another
```{r, Best model selection}
anova(m1,m2,m3)
```
As we can see, second model lm(mpg~wt+am) is better than first one lm(mpg~am) because anova test show positive difference of RSSs= 442.58 and P-value for F statistic is small= 7.717e-09.

However third model lm(mpg~wt*am) with interaction term is better than second one since third model further reduce sum of squared differences and p-value is still low=0.001017.

So the third model lm(mpg~wt*am) is the best one.

###Residuals and Diagnostics

#Conclusion

###Is an automatic or manual transmission better for MPG?

###Quantify the MPG difference between automatic and manual transmissions

#Appendix